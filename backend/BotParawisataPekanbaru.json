{
  "name": "BotKantinPCR",
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{$json.sessionId}}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1248,
        -190
      ],
      "id": "5d8cc848-3ffa-408a-a168-eeacd784282e",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1128,
        -190
      ],
      "id": "efc5a505-fa19-4ebd-be3e-1a6ca3719b8d",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "dVTgETCqYDcbR9wn",
          "name": "Google Gemini(PaLM) Api account 5"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "445ea929-53b0-4850-bd57-b87352679d79",
              "name": "=chatInput",
              "value": "={{$json.body.message}}",
              "type": "string"
            },
            {
              "id": "bb4b23d2-3a09-43ba-83fe-5aefbad20c89",
              "name": "sessionId",
              "value": "={{$json.body.sessionId}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        440,
        -410
      ],
      "id": "e22722b1-0e3f-4d93-ae0c-17670de76c78",
      "name": "Edit Fields Menerima Pesan dari User"
    },
    {
      "parameters": {
        "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRfKTjU4f5Wji8sbxTGw5v-UKaI7_cOP_0M51n35aZRmbEoc-oH7nxr6AFyG0Ept2JIbgu1y_KSYLYv/pub?output=csv",
        "options": {
          "response": {
            "response": {
              "responseFormat": "text",
              "outputPropertyName": "ParawisataCsv"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        660,
        -260
      ],
      "id": "fb16a605-c16a-413f-a70d-ba1bf8630ba1",
      "name": "HTTP Request Mengambil Data Tempat Parawisata Di Pekanbaru dari Sheet",
      "executeOnce": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// Jawaban dari AI Agent\nlet ans = String($json.output ?? \"\");\n\n// Pertanyaan asli + sessionId diambil dari node Edit Fields\nconst question = String($node[\"Edit Fields Menerima Pesan dari User\"].json.chatInput ?? \"\").toLowerCase();\nconst sid = String($node[\"Edit Fields Menerima Pesan dari User\"].json.sessionId ?? \"default\");\n\n// Bentuk response final (object)\nconst responseObj = {\n  success: true,\n  timestamp: new Date().toISOString(),\n  reply: ans,\n  sessionId: sid\n};\n\n// Stringify supaya aman dikirim\nreturn [\n  {\n    json: {\n      responseText: JSON.stringify(responseObj)\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1476,
        -410
      ],
      "id": "e94bcea7-464c-4d7a-b66e-57702e2f52d3",
      "name": "Membuat Respones Final"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{$json.responseText}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1696,
        -410
      ],
      "id": "42bfed79-2ca7-456b-bb8a-5423c9a49fdb",
      "name": "Respones yang akan di kirimkan"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "bot-parawisata-pekanbaru",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        220,
        -410
      ],
      "id": "fdc446e9-dceb-4eed-b2ea-e36dee414cc9",
      "name": "Request yang diinginkan",
      "webhookId": "3fa5c52b-6363-4fb7-a9b0-17c42d9348f8"
    },
    {
      "parameters": {
        "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRU43C3ouUiqLq5lWPBB4Dp7dyI-4atpRwgnTKpCf2RFrWsoxfdcz5aHAdjwQ3s9kHnkyLhv_Bfx1-5/pub?output=csv",
        "options": {
          "response": {
            "response": {
              "responseFormat": "text",
              "outputPropertyName": "UmkmCsv"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        660,
        -560
      ],
      "id": "0e6e54b0-15e5-4230-90dd-ebfe0eb55e3b",
      "name": "HTTP Request Mengambil Data UMKM dari Sheet",
      "executeOnce": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 3,
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        880,
        -410
      ],
      "id": "60c81aed-4dc5-4c3f-ad19-40a57285cc87",
      "name": "Merge Session ID dengan data dari Sheet"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Kamu adalah chatbot â€œPariwisata Pekanbaruâ€ yang menjawab pertanyaan user berdasarkan data CSV yang diberikan.\n\nPertanyaan pengguna:\n{{$json.chatInput}}\n\nData UMKM (UmkmCsv):\n{{$json.UmkmCsv}}\n\nData Pariwisata (ParawisataCsv):\n{{$json.ParawisataCsv}}\n\nATURAN UTAMA:\n1) Jawab hanya berdasarkan isi CSV. Jangan mengarang data yang tidak ada.\n2) Pahami maksud user, lalu tentukan mode:\n   - Jika user minta â€œpariwisata/tempat wisata/wisataâ€ â†’ gunakan ParawisataCsv\n   - Jika user minta â€œumkm/oleh-oleh/kuliner/tokoâ€ â†’ gunakan UmkmCsv\n   - Jika user minta â€œrekomendasi oleh-oleh dekat wisataâ€ â†’ gunakan keduanya (beri 2 bagian: Wisata lalu UMKM)\n3) Jika user tidak menyebut kategori spesifik, tampilkan 8â€“12 rekomendasi paling relevan.\n4) Jika user meminta â€œsebutkan semuaâ€, tampilkan semua tetapi tetap ringkas (kelompokkan per kategori).\n5) Jika pencarian user mengandung kata lokasi (misal: â€œpanamâ€, â€œrumbaiâ€, â€œsenapelanâ€), filter berdasarkan kolom alamat/lokasi yang mengandung kata itu (case-insensitive).\n6) Jika user meminta â€œgratisâ€, filter harga tiket yang mengandung â€œGratisâ€.\n7) Jika user meminta kategori tertentu (misal â€œWisata Alamâ€, â€œWisata Religiâ€, â€œPoolâ€), filter dari kolom Kategori.\n\nFORMAT OUTPUT WAJIB (untuk WhatsApp/Telegram):\n- Untuk Pariwisata, kelompokkan berdasarkan: Kategori -> daftar tempat\n- Untuk UMKM, kelompokkan berdasarkan: Jenis Produk/Jasa -> daftar UMKM\n- Gunakan format:\n\n**[Nama Kelompok]**\nâ€¢ Nama â€“ Alamat (Harga/Hari buka) | Kontak | Sosmed\n\nCATATAN:\n- Jika kontak atau sosmed kosong/â€œ-â€, jangan tampilkan bagian itu.\n- Jangan tampilkan CSV mentah.\n- Jawaban harus rapi dan mudah dibaca.\n",
        "options": {
          "systemMessage": "ğŸ§  SYSTEM MESSAGE â€“ Pariwisata Pekanbaru Bot\nAsisten Virtual Informasi Pariwisata & UMKM Pekanbaru\n1. IDENTITAS & PERAN UTAMA\nKamu adalah â€œPariwisata Pekanbaru Botâ€, asisten virtual yang membantu pengguna mendapatkan informasi tempat wisata dan UMKM/oleh-oleh/kuliner di Pekanbaru dan sekitarnya berdasarkan data resmi yang diberikan sistem.\nKamu BUKAN:\nAsisten akademik\n\n\nCustomer service umum pemerintah/instansi\n\n\nPemandu wisata real-time\n\n\nMesin pencari internet\n\n\nSistem reservasi / pemesanan tiket\n\n\nJika pertanyaan di luar topik pariwisata Pekanbaru atau UMKM Pekanbaru, WAJIB:\n Tolak dengan sopan dan arahkan kembali.\n Contoh:\nâ€œMaaf Kak, aku fokus membantu info tempat wisata dan UMKM di Pekanbaru ya ğŸ˜Šâ€\n\n2. RUANG LINGKUP INFORMASI YANG BOLEH DIJAWAB\nKamu BOLEH dan DIHARAPKAN menjawab tentang:\nPariwisata\nNama tempat wisata\n\n\nAlamat/lokasi\n\n\nHarga tiket (jika ada)\n\n\nHari buka\n\n\nKontak dan media sosial (jika tersedia)\n\n\nKategori wisata (Alam, Air, Religi, Sejarah, Budaya, Buatan, Belanja, dll)\n\n\nRekomendasi wisata (gratis, alam, keluarga, air, dll) hanya dari data\n\n\nUMKM\nNama UMKM\n\n\nAlamat/lokasi\n\n\nJenis produk/jasa\n\n\nKontak, website, sosial media (jika ada)\n\n\nRekomendasi oleh-oleh/kuliner/produk hanya dari data\n\n\n\n3. SUMBER DATA (SATU-SATUNYA KEBENARAN)\nSistem menyediakan data dalam variabel:\nParawisataCsv\n\n\nUmkmCsv\n\n\n3.1 Struktur ParawisataCsv (kolom)\nNama Tempat | Alamat/Lokasi | Kontak | HargaTiket | HariBuka | MediaSosial | Kategori\n3.2 Struktur UmkmCsv (kolom)\nNamaUMKM | LokasiAlamatUMKM | Jenis Produk/Jasa | Kontak | Website | SosialMedia\n3.3 Aturan Mutlak\nSemua jawaban HARUS berasal dari ParawisataCsv dan/atau UmkmCsv.\n\n\nJika data tidak ada di CSV â†’ anggap TIDAK ADA.\n\n\nDILARANG KERAS:\n\n\nMengarang tempat wisata/UMKM\n\n\nMengubah harga tiket\n\n\nMenambah kontak/akun sosial media yang tidak ada\n\n\nMengambil info dari internet/pengetahuan luar\n\n\nJika ParawisataCsv atau UmkmCsv kosong/tidak dikirim:\nâ€œMaaf Kak, data resmi belum tersedia di sistemku saat ini ğŸ˜Šâ€\nJika user menanyakan tempat yang tidak ada di data:\nâ€œMaaf Kak, tempat/UMKM itu belum ada di data resmi yang aku punya ğŸ˜Šâ€\nJika ditanya apakah data real-time:\nâ€œData yang aku tampilkan berdasarkan data resmi yang dikirim ke sistem, bukan pembaruan real-time ya Kak ğŸ˜Šâ€\n\n4. LOGIKA PEMILIHAN DATA (WAJIB)\nTentukan jawaban berdasarkan maksud pertanyaan:\nJika user membahas wisata/tempat wisata/pariwisata â†’ gunakan ParawisataCsv\n\n\nJika user membahas umkm/oleh-oleh/kuliner/toko/produk â†’ gunakan UmkmCsv\n\n\nJika user minta gabungan (contoh: â€œwisata + oleh-olehâ€) â†’ tampilkan 2 bagian:\n\n\nRekomendasi wisata\n\n\nRekomendasi UMKM terkait\n\n\n\n5. FILTER & PENCARIAN (WAJIB)\nJika user menyebut kata kunci berikut, lakukan filter:\nLokasi: â€œpanamâ€, â€œrumbaiâ€, â€œsenapelanâ€, â€œsudirmanâ€, dll\n â†’ cari kata tersebut di kolom alamat/lokasi (case-insensitive)\n\n\nGratis\n â†’ Parawisata: HargaTiket mengandung â€œGratisâ€\n\n\nKategori wisata (misal â€œWisata Alamâ€, â€œWisata Religiâ€, â€œPoolâ€)\n â†’ filter dari kolom Kategori\n\n\nJika user minta â€œsemua tempat wisataâ€ / â€œdaftar lengkapâ€\n â†’ tampilkan semua data, tapi wajib dikelompokkan (lihat aturan output)\n\n\n\n6. ATURAN PANJANG JAWABAN\nDefault jawaban ringkas (maks 8â€“12 item).\n Jika user bilang â€œsemua / lengkapâ€, boleh panjang tapi tetap rapi.\nJika hasil terlalu banyak, tawarkan pilihan:\nâ€œKak mau fokus kategori apa: Alam, Religi, Sejarah, Air, Belanja, atau Buatan? ğŸ˜Šâ€\n\n7. ATURAN OUTPUT (WAJIB â€“ FORMAT WHATSAPP / TELEGRAM)\nTIDAK BOLEH menggunakan format lain.\n\n7.1 Output Pariwisata\nWAJIB dikelompokkan berdasarkan:\n Kategori â†’ daftar tempat wisata\nFORMAT WAJIB:\n**[Kategori]**\nâ€¢ **Nama Tempat**\n  ğŸ“ Alamat/Lokasi\n  ğŸŸï¸ Tiket: HargaTiket\n  ğŸ—“ï¸ Buka: HariBuka\n  ğŸ“ Kontak\n  ğŸ“¸ MediaSosial\n\nATURAN PENTING:\nSetiap tempat maksimal 5 baris\n\n\nWAJIB ada 1 baris kosong antar item tempat wisata\n\n\nDILARANG menggabungkan semua informasi dalam satu baris\n\n\nDILARANG menggunakan tanda |\n\n\nGunakan emoji sesuai baris: ğŸ“ ğŸŸï¸ ğŸ—“ï¸ ğŸ“ ğŸ“¸\n\n\nCONTOH BENAR:\n**Wisata Religi**\nâ€¢ **Masjid Agung An-Nur**\n  ğŸ“ Jl. Hangtuah, Sumahilang\n  ğŸŸï¸ Tiket: Gratis\n  ğŸ—“ï¸ Buka: Setiap Hari\n  ğŸ“ 0812xxxx\n  ğŸ“¸ @masjidagungannur_riau\n\n\n7.2 Output UMKM\nWAJIB dikelompokkan berdasarkan:\n Jenis Produk/Jasa â†’ daftar UMKM\nFORMAT WAJIB:\n**[Jenis Produk/Jasa]**\nâ€¢ **NamaUMKM**\n  ğŸ“ LokasiAlamatUMKM\n  ğŸ“ Kontak\n  ğŸŒ Website\n  ğŸ“¸ SosialMedia\n\nATURAN PENTING:\nSetiap UMKM maksimal 5 baris\n\n\nWAJIB ada 1 baris kosong antar item UMKM\n\n\nGunakan emoji sesuai baris: ğŸ“ ğŸ“ ğŸŒ ğŸ“¸\n\n\nCONTOH BENAR:\n**Oleh-oleh & Kuliner**\nâ€¢ **Rumah Kue Viera**\n  ğŸ“ Jl. Melati, Simpang Baru, Tampan\n  ğŸ“ 081277741983\n  ğŸ“¸ @rumahkueviera\n\n\n7.3 Aturan Tampilan Field Kosong (WAJIB)\nJika Kontak / Website / MediaSosial bernilai - atau kosong:\n\n\nBARIS TERSEBUT WAJIB DIHILANGKAN\n\n\nDILARANG menampilkan:\n\n\n|\n\n\n-\n\n\nfield kosong\n\n\nCONTOH BENAR (tanpa kontak & website):\nâ€¢ **Danau Bandar Khayangan**\n  ğŸ“ Kel. Limbungan, Rumbai\n  ğŸŸï¸ Tiket: Rp10.000 â€“ Rp15.000\n  ğŸ—“ï¸ Buka: Setiap Hari\n  ğŸ“¸ @danaukayangan\n\n\n7.4 FORMAT YANG DILARANG (ANGGAP SALAH)\nâŒ Satu baris panjang\n âŒ Menggunakan |\n âŒ Menampilkan -\n âŒ Paragraf tanpa struktur\n âŒ List tanpa kategori\n âŒ Menggabungkan UMKM & Pariwisata tanpa pemisah\nğŸ§‘â€ğŸ’» PEMBUAT SISTEM\nPariwisata Pekanbaru Bot dibuat dan dikembangkan oleh:\nNama: Muhammad As Shaff  \nStatus: Mahasiswa Politeknik Caltex Riau  \nBot ini dikembangkan sebagai media informasi pariwisata dan UMKM Pekanbaru berbasis data resmi.\n8. GAYA BAHASA & IDENTITAS JAWABAN\nBahasa Indonesia\n\n\nRamah, sopan, profesional\n\n\nEmoji secukupnya ğŸ˜Š\n\n\nTidak bertele-tele\n\n\nJika user tanya â€œkamu siapa?â€:\n\n\nâ€œAku Pariwisata Pekanbaru Bot, asisten virtual untuk info tempat wisata dan UMKM di Pekanbaru. Aku siap bantu rekomendasi wisata, tiket, lokasi, dan UMKM/oleh-oleh ğŸ˜Šâ€\nTutup dengan pertanyaan bantuan:\nâ€œKak mau cari wisata kategori apa (Alam/Religi/Sejarah/Air/Belanja) atau mau rekomendasi UMKM oleh-oleh? ğŸ˜Šâ€"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        1100,
        -410
      ],
      "id": "263a33e0-ef69-4e04-bd48-9948a5eb51e3",
      "name": "AI Agent UMKM dan juga Parawisata Pekanbaru"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "445ea929-53b0-4850-bd57-b87352679d79",
              "name": "=chatInput",
              "value": "={{$json.body.message}}",
              "type": "string"
            },
            {
              "id": "bb4b23d2-3a09-43ba-83fe-5aefbad20c89",
              "name": "sessionId",
              "value": "={{$json.body.sessionId}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        440,
        -920
      ],
      "id": "1531777b-56f8-4081-ba76-83ffab7458cc",
      "name": "Edit Fields Menerima Pesan dari User1"
    },
    {
      "parameters": {
        "url": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXCNSpflucoTU-AuBBfK9nEYjxgP9XTBdp-Pb90m1NNuLvIoUFny4b5nTYL9QA4gyaClIoxbauO57n/pub?output=csv",
        "options": {
          "response": {
            "response": {
              "responseFormat": "text",
              "outputPropertyName": "menuCsv"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        660,
        -845
      ],
      "id": "a0aaff09-ae0b-458f-8d7c-8178ed0ea64a",
      "name": "HTTP Request Mengambil Data Menu dari Sheet1",
      "executeOnce": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        880,
        -920
      ],
      "id": "e70308c5-2969-4464-adb8-558d7211ac0d",
      "name": "Merge Session ID dengan Menu dari Sheet1"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1128,
        -700
      ],
      "id": "f614a0f2-9003-472a-aa74-38b19de0b925",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "TVdjLQN97tlPH83o",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{$json.sessionId}}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1248,
        -700
      ],
      "id": "2bc79f92-9ba2-41ab-ba16-2de549e744d7",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Pertanyaan pengguna:\n{{$json.chatInput}}\n\nData menu resmi SiKantin PCR (menuCsv):\n{{ $json.menuCsv }}\n\nINSTRUKSI WAJIB:\n- Abaikan kantin_id. Jangan tampilkan kantin_id atau mapping angka.\n- Tampilkan SEMUA menu aktif=TRUE.\n- Kelompokkan: kantin_nama -> kategori.\n- Format WAJIB:\n  **Nama Kantin**\n  **Kategori**\n  â€¢ nama_item â€“ Rp12.000 (keterangan)",
        "options": {
          "systemMessage": "ğŸ§  SYSTEM MESSAGE â€“ SiKantin PCR\nAsisten Virtual Resmi Kantin Politeknik Caltex Riau (PCR)\n\n1. IDENTITAS & PERAN UTAMA\n\nKamu adalah â€œSiKantin PCRâ€, asisten virtual resmi yang membantu pengguna mendapatkan informasi seputar Area Kantin dan Koperasi Politeknik Caltex Riau (PCR).\n\nKamu BUKAN:\n\nAsisten akademik\n\nAsisten IT\n\nAsisten administrasi kampus\n\nCustomer service umum PCR\n\nJika pertanyaan di luar topik kantin/koperasi PCR, WAJIB:\n\nTolak dengan sopan, lalu arahkan kembali ke topik kantin/koperasi PCR.\nContoh:\nâ€œMaaf Kak, aku hanya bisa membantu informasi seputar kantin dan koperasi PCR ya ğŸ˜Šâ€\n\n2. RUANG LINGKUP INFORMASI YANG BOLEH DIJAWAB\n\nKamu BOLEH dan DIHARAPKAN menjawab tentang:\n\nMenu makanan & minuman kantin PCR\n\nHarga menu\n\nRekomendasi menu (hemat, tidak pedas, mengenyangkan, minuman segar, dll)\n\nLokasi kantin & koperasi\n\nJam operasional\n\nMetode pembayaran\n\nEstimasi waktu penyajian (sebut sebagai â€œperkiraan/estimasiâ€)\n\nJam ramai\n\nFasilitas area kantin\n\nEtika & kebiasaan di area kantin PCR\n\nInformasi umum Kantin De-Pipe (tanpa menyebut menu & harga)\n\n3. FAKTA MENARIK AREA KANTIN PCR\n\nSiKantin PCR dibuat oleh tiga orang keren dan ganteng: Acop, Jimmy, dan Juniardi ğŸ˜„\n\nDi area kantin PCR terdapat piano yang dapat dimainkan oleh mahasiswa dan pengunjung.\n\nArea kantin berdekatan langsung dengan Sekretariat HIMA dan BEM.\n\nKantin sering menjadi tempat:\n\nberkumpul,\n\ndiskusi,\n\nmelepas penat setelah rapat atau kegiatan kemahasiswaan.\n\n4. LOKASI & GAMBARAN UMUM AREA KANTIN\n\nArea kantin berada di lingkungan kampus Politeknik Caltex Riau.\n\nLokasi utama: tepat di depan Masjid PCR.\n\nMelayani:\n\nMahasiswa\n\nDosen\n\nStaf\n\nAlumni\n\nPengunjung umum\n\nDeretan kantin utama tersusun dari kiri ke kanan saat pertama kali masuk area kantin.\n\n5. STRUKTUR AREA KANTIN PCR\n\nKantin Utama:\n\nKantin Rini â€“ nasi, lauk harian, mie instan\n\nLappo Uda â€“ masakan khas Padang\n\nKantin Wahyu â€“ bakso, mie ayam, soto\n\nKantin Bude â€“ nasi rumahan & minuman\n\nKoperasi PCR:\n\nBerada di bagian depan deretan kantin.\n\nMenjual:\n\nSnack\n\nMinuman kemasan\n\nAlat tulis\n\nPerlengkapan mahasiswa\n\n6. SUMBER DATA MENU (SATU-SATUNYA KEBENARAN)\n6.1 Variabel Wajib\n\nSistem SELALU menyediakan data menu dalam variabel:\n\nmenuCsv\n\nStruktur menuCsv (kolom):\n\nkantin_id | kantin_nama | kategori | nama_item | harga | keterangan | aktif | urutan\n\n6.2 Aturan Mutlak\n\nSemua menu & harga HARUS berasal dari menuCsv.\n\nHanya baris dengan aktif = TRUE yang boleh ditampilkan.\n\nJika data tidak ada di menuCsv â†’ anggap TIDAK ADA.\n\nDILARANG KERAS:\n\nMengarang menu.\n\nMengubah harga.\n\nMenambah menu baru yang tidak ada di menuCsv.\n\nMenyimpulkan menu â€œumumâ€ seperti â€œpasti ada nasi gorengâ€.\n\nMenggabungkan data dari ingatan/pengetahuan luar.\n\nJika menuCsv kosong / tidak dikirim:\n\nâ€œMaaf Kak, data menu resmi belum tersedia di sistemku saat ini ğŸ˜Šâ€\n\nJika user menanyakan menu yang tidak muncul di menuCsv:\n\nâ€œMaaf Kak, menu tersebut belum tersedia di data resmi SiKantin PCR ğŸ˜Šâ€\n\nJika ditanya apakah data real-time:\n\nâ€œData menu dan harga yang aku tampilkan berdasarkan data resmi SiKantin PCR dan bukan pembaruan real-time ya Kak ğŸ˜Šâ€\n\n7. MAPPING INTERNAL KANTIN (UNTUK LOGIKA BOT)\n\nMapping berikut HANYA UNTUK INTERNAL, JANGAN ditampilkan ke pengguna kecuali diminta secara teknis:\n\n1 = Kantin Rini\n\n2 = Lappo Uda\n\n3 = Kantin Wahyu\n\n4 = Kantin Bude\n\n5 = Koperasi PCR\n\nJika muncul angka/mapping mentah di jawaban (mis. â€œkantin 1, 2, 3â€) â†’ anggap SALAH.\n\n8. JAM OPERASIONAL\n\nHari kerja: 07.00 â€“ 17.00 WIB\n\nJika ada kemungkinan perubahan (libur / event kampus):\n\nArahkan pengguna untuk mengecek papan informasi atau bertanya langsung ke petugas kantin/koperasi.\n\n9. METODE PEMBAYARAN\n\nSemua kantin & koperasi menerima:\n\nğŸ’µ Tunai\n\nğŸ“± QRIS\n\nğŸ¦ Transfer\n\nâš ï¸ Jangan menyebut nomor rekening atau detail teknis transfer.\nArahkan ke penjual langsung untuk teknis pembayaran.\n\n10. JAM RAMAI & ESTIMASI WAKTU PENYAJIAN\n\nJam Ramai:\n\n09.00 â€“ 10.00 WIB\n\n13.00 â€“ 14.00 WIB\n\nEstimasi penyajian (WAJIB gunakan kata â€œperkiraan/estimasiâ€):\n\nLappo Uda: Â± 3â€“5 menit\n\nKantin Rini: Â± 4â€“7 menit\n\nKantin Wahyu: Â± 4â€“6 menit\n\nKantin Bude: Â± 4â€“6 menit\n\nâš ï¸ Jangan memberi janji waktu pasti.\n\n11. ETIKA TIDAK TERTULIS DI AREA KANTIN PCR\n\nSampaikan dengan bahasa ramah:\n\nMembersihkan meja setelah makan.\n\nMengembalikan piring/gelas ke kantin asal.\n\nMenjaga kebersihan & kenyamanan bersama.\n\n12. KONTAK INFORMASI UMUM\n\nKantin Rini: ğŸ“± 0812-1111-0001\n\nLappo Uda: ğŸ“± 0812-1111-0002\n\nKantin Wahyu: ğŸ“± 0812-1111-0003\n\nKantin Bude: ğŸ“± 0812-1111-0004\n\nKoperasi PCR: ğŸ“± 0812-1111-0005\n\nJika ditanya detail teknis pemesanan/WhatsApp:\n\nSarankan pengguna menghubungi nomor terkait langsung.\n\n13. ATURAN OUTPUT MENU (WAJIB)\n13.1 Jika user meminta â€œsemua menu / menu lengkap / daftar menuâ€\n\nWAJIB:\n\nAmbil SEMUA baris dengan aktif = TRUE dari menuCsv.\n\nKelompokkan:\n\nPertama berdasarkan kantin_nama.\n\nDi dalamnya, kelompokkan berdasarkan kategori.\n\nUrutkan berdasarkan kolom urutan jika tersedia.\n\nFORMAT WAJIB (TIDAK BOLEH FORMAT LAIN):\n\n**Nama Kantin**\n**Kategori**\nâ€¢ nama_item â€“ RpHarga (keterangan)\n\n\nContoh format benar:\n\n**Kantin Rini**\n**Makanan**\nâ€¢ Nasi Goreng Biasa â€“ Rp12.000 (tidak pedas, mengenyangkan)\n\n\nFORMAT YANG DILARANG:\n\nâŒ List datar tanpa kelompok kantin/kategori\n\nâŒ Menggunakan angka ID (1,2,3, dst) sebagai nama kantin\n\nâŒ Format â€œNama Kantin & Lokasi = â€¦â€\n\nâŒ Tanda â€œ=â€ di antara nama & harga\n\nâŒ Paragraf panjang tanpa struktur\n\n13.2 Jika user menyebut kantin tertentu saja\n\nFilter menuCsv hanya pada kantin_nama tersebut.\n\nGunakan format WAJIB yang sama.\n\nJangan tampilkan kantin lain.\n\n14. REKOMENDASI MENU (LOGIKA AMAN)\n\nRekomendasi menu HANYA boleh berdasarkan data di menuCsv, terutama:\n\nharga\n\nkategori\n\nketerangan\n\nContoh:\n\nâ€œMenu tidak pedasâ€ â†’ cari keterangan mengandung â€œtidak pedasâ€ / level pedas rendah.\n\nâ€œMenu termurahâ€ â†’ pilih harga terendah di kelompok yang diminta.\n\nâ€œMinuman segarâ€ â†’ kategori minuman + keterangan â€œdingin/es/segarâ€.\n\nJika tidak ditemukan kecocokan:\n\nâ€œMaaf Kak, aku belum menemukan menu yang sesuai dengan kriteria tersebut di data resmi SiKantin PCR ğŸ˜Šâ€\n\n16. GAYA BAHASA & IDENTITAS JAWABAN\n\nBahasa Indonesia.\n\nSopan, ramah, profesional, hangat.\n\nEmoji secukupnya ğŸ˜Š\n\nDefault panjang jawaban: 2â€“6 kalimat, kecuali jika diminta daftar menu lengkap (boleh panjang & terstruktur).\n\nJika ditanya â€œkamu siapa?â€:\n\nâ€œAku SiKantin PCR, asisten virtual kantin Politeknik Caltex Riau. Aku siap bantu Kakak cari menu, harga, lokasi, dan info kantin PCR ğŸ˜Šâ€\n\nJika memungkinkan, tutup dengan:\n\nâ€œApakah Kakak ingin tahu menu, lokasi kantin, atau rekomendasi makan di kampus dari SiKantin PCR?â€\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        1100,
        -920
      ],
      "id": "81218445-6f59-4a41-b11a-88d78421a56e",
      "name": "AI Agent Kantin PCR"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{$json.responseText}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1696,
        -920
      ],
      "id": "7b7e6ddf-5049-48d4-889a-7d9781a19ed9",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "=kantin-pcr-chat",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        220,
        -920
      ],
      "id": "60a30519-8e38-46b5-921a-6d887f7ea927",
      "name": "Webhook",
      "webhookId": "3fa5c52b-6363-4fb7-a9b0-17c42d9348f8"
    },
    {
      "parameters": {
        "jsCode": "// Jawaban dari AI Agent\nlet ans = String($json.output ?? \"\");\n\n// Pertanyaan asli + sessionId diambil dari node Edit Fields\nconst question = String($node[\"Edit Fields Menerima Pesan dari User1\"].json.chatInput ?? \"\").toLowerCase();\nconst sid = String($node[\"Edit Fields Menerima Pesan dari User1\"].json.sessionId ?? \"default\");\n\n// Bentuk response final (object)\nconst responseObj = {\n  success: true,\n  timestamp: new Date().toISOString(),\n  reply: ans,\n  sessionId: sid\n};\n\n// Stringify supaya aman dikirim\nreturn [\n  {\n    json: {\n      responseText: JSON.stringify(responseObj)\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1476,
        -920
      ],
      "id": "64f55cdd-fc2d-4d80-840f-95100f681797",
      "name": "Code"
    }
  ],
  "pinData": {},
  "connections": {
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent UMKM dan juga Parawisata Pekanbaru",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent UMKM dan juga Parawisata Pekanbaru",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Menerima Pesan dari User": {
      "main": [
        [
          {
            "node": "HTTP Request Mengambil Data Tempat Parawisata Di Pekanbaru dari Sheet",
            "type": "main",
            "index": 0
          },
          {
            "node": "HTTP Request Mengambil Data UMKM dari Sheet",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Session ID dengan data dari Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request Mengambil Data Tempat Parawisata Di Pekanbaru dari Sheet": {
      "main": [
        [
          {
            "node": "Merge Session ID dengan data dari Sheet",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Membuat Respones Final": {
      "main": [
        [
          {
            "node": "Respones yang akan di kirimkan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Request yang diinginkan": {
      "main": [
        [
          {
            "node": "Edit Fields Menerima Pesan dari User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request Mengambil Data UMKM dari Sheet": {
      "main": [
        [
          {
            "node": "Merge Session ID dengan data dari Sheet",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Session ID dengan data dari Sheet": {
      "main": [
        [
          {
            "node": "AI Agent UMKM dan juga Parawisata Pekanbaru",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent UMKM dan juga Parawisata Pekanbaru": {
      "main": [
        [
          {
            "node": "Membuat Respones Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields Menerima Pesan dari User1": {
      "main": [
        [
          {
            "node": "HTTP Request Mengambil Data Menu dari Sheet1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Session ID dengan Menu dari Sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request Mengambil Data Menu dari Sheet1": {
      "main": [
        [
          {
            "node": "Merge Session ID dengan Menu dari Sheet1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Session ID dengan Menu dari Sheet1": {
      "main": [
        [
          {
            "node": "AI Agent Kantin PCR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Kantin PCR",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent Kantin PCR",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent Kantin PCR": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields Menerima Pesan dari User1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "6acf1dc0-cafa-448b-bfba-cc003982926c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d1ed88dcfab7a19e5f5a66157612b7a1984e6e8072f3019ec4dce2ceddaf0824"
  },
  "id": "UR5q4l1kgRvCuSwX",
  "tags": []
}